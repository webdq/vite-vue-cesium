{"version":3,"file":"createCoplanarPolygonOutlineGeometry.js","sources":["../../../../Source/Core/CoplanarPolygonOutlineGeometry.js","../../../../Source/WorkersES6/createCoplanarPolygonOutlineGeometry.js"],"sourcesContent":["import arrayRemoveDuplicates from \"./arrayRemoveDuplicates.js\";\r\nimport BoundingSphere from \"./BoundingSphere.js\";\r\nimport Cartesian3 from \"./Cartesian3.js\";\r\nimport Check from \"./Check.js\";\r\nimport ComponentDatatype from \"./ComponentDatatype.js\";\r\nimport CoplanarPolygonGeometryLibrary from \"./CoplanarPolygonGeometryLibrary.js\";\r\nimport defaultValue from \"./defaultValue.js\";\r\nimport defined from \"./defined.js\";\r\nimport Geometry from \"./Geometry.js\";\r\nimport GeometryAttribute from \"./GeometryAttribute.js\";\r\nimport GeometryAttributes from \"./GeometryAttributes.js\";\r\nimport GeometryInstance from \"./GeometryInstance.js\";\r\nimport GeometryPipeline from \"./GeometryPipeline.js\";\r\nimport IndexDatatype from \"./IndexDatatype.js\";\r\nimport PolygonGeometryLibrary from \"./PolygonGeometryLibrary.js\";\r\nimport PrimitiveType from \"./PrimitiveType.js\";\r\n\r\nfunction createGeometryFromPositions(positions) {\r\n  const length = positions.length;\r\n  const flatPositions = new Float64Array(length * 3);\r\n  const indices = IndexDatatype.createTypedArray(length, length * 2);\r\n\r\n  let positionIndex = 0;\r\n  let index = 0;\r\n\r\n  for (let i = 0; i < length; i++) {\r\n    const position = positions[i];\r\n    flatPositions[positionIndex++] = position.x;\r\n    flatPositions[positionIndex++] = position.y;\r\n    flatPositions[positionIndex++] = position.z;\r\n\r\n    indices[index++] = i;\r\n    indices[index++] = (i + 1) % length;\r\n  }\r\n\r\n  const attributes = new GeometryAttributes({\r\n    position: new GeometryAttribute({\r\n      componentDatatype: ComponentDatatype.DOUBLE,\r\n      componentsPerAttribute: 3,\r\n      values: flatPositions,\r\n    }),\r\n  });\r\n\r\n  return new Geometry({\r\n    attributes: attributes,\r\n    indices: indices,\r\n    primitiveType: PrimitiveType.LINES,\r\n  });\r\n}\r\n\r\n/**\r\n * A description of the outline of a polygon composed of arbitrary coplanar positions.\r\n *\r\n * @alias CoplanarPolygonOutlineGeometry\r\n * @constructor\r\n *\r\n * @param {Object} options Object with the following properties:\r\n * @param {PolygonHierarchy} options.polygonHierarchy A polygon hierarchy that can include holes.\r\n *\r\n * @see CoplanarPolygonOutlineGeometry.createGeometry\r\n *\r\n * @example\r\n * const polygonOutline = new Cesium.CoplanarPolygonOutlineGeometry({\r\n *   positions : Cesium.Cartesian3.fromDegreesArrayHeights([\r\n *      -90.0, 30.0, 0.0,\r\n *      -90.0, 30.0, 1000.0,\r\n *      -80.0, 30.0, 1000.0,\r\n *      -80.0, 30.0, 0.0\r\n *   ])\r\n * });\r\n * const geometry = Cesium.CoplanarPolygonOutlineGeometry.createGeometry(polygonOutline);\r\n */\r\nfunction CoplanarPolygonOutlineGeometry(options) {\r\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\r\n  const polygonHierarchy = options.polygonHierarchy;\r\n  //>>includeStart('debug', pragmas.debug);\r\n  Check.defined(\"options.polygonHierarchy\", polygonHierarchy);\r\n  //>>includeEnd('debug');\r\n\r\n  this._polygonHierarchy = polygonHierarchy;\r\n  this._workerName = \"createCoplanarPolygonOutlineGeometry\";\r\n\r\n  /**\r\n   * The number of elements used to pack the object into an array.\r\n   * @type {Number}\r\n   */\r\n  this.packedLength =\r\n    PolygonGeometryLibrary.computeHierarchyPackedLength(polygonHierarchy) + 1;\r\n}\r\n\r\n/**\r\n * A description of a coplanar polygon outline from an array of positions.\r\n *\r\n * @param {Object} options Object with the following properties:\r\n * @param {Cartesian3[]} options.positions An array of positions that defined the corner points of the polygon.\r\n * @returns {CoplanarPolygonOutlineGeometry}\r\n */\r\nCoplanarPolygonOutlineGeometry.fromPositions = function (options) {\r\n  options = defaultValue(options, defaultValue.EMPTY_OBJECT);\r\n\r\n  //>>includeStart('debug', pragmas.debug);\r\n  Check.defined(\"options.positions\", options.positions);\r\n  //>>includeEnd('debug');\r\n\r\n  const newOptions = {\r\n    polygonHierarchy: {\r\n      positions: options.positions,\r\n    },\r\n  };\r\n  return new CoplanarPolygonOutlineGeometry(newOptions);\r\n};\r\n\r\n/**\r\n * Stores the provided instance into the provided array.\r\n *\r\n * @param {CoplanarPolygonOutlineGeometry} value The value to pack.\r\n * @param {Number[]} array The array to pack into.\r\n * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.\r\n *\r\n * @returns {Number[]} The array that was packed into\r\n */\r\nCoplanarPolygonOutlineGeometry.pack = function (value, array, startingIndex) {\r\n  //>>includeStart('debug', pragmas.debug);\r\n  Check.typeOf.object(\"value\", value);\r\n  Check.defined(\"array\", array);\r\n  //>>includeEnd('debug');\r\n\r\n  startingIndex = defaultValue(startingIndex, 0);\r\n\r\n  startingIndex = PolygonGeometryLibrary.packPolygonHierarchy(\r\n    value._polygonHierarchy,\r\n    array,\r\n    startingIndex\r\n  );\r\n\r\n  array[startingIndex] = value.packedLength;\r\n\r\n  return array;\r\n};\r\n\r\nconst scratchOptions = {\r\n  polygonHierarchy: {},\r\n};\r\n/**\r\n * Retrieves an instance from a packed array.\r\n *\r\n * @param {Number[]} array The packed array.\r\n * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.\r\n * @param {CoplanarPolygonOutlineGeometry} [result] The object into which to store the result.\r\n * @returns {CoplanarPolygonOutlineGeometry} The modified result parameter or a new CoplanarPolygonOutlineGeometry instance if one was not provided.\r\n */\r\nCoplanarPolygonOutlineGeometry.unpack = function (\r\n  array,\r\n  startingIndex,\r\n  result\r\n) {\r\n  //>>includeStart('debug', pragmas.debug);\r\n  Check.defined(\"array\", array);\r\n  //>>includeEnd('debug');\r\n\r\n  startingIndex = defaultValue(startingIndex, 0);\r\n\r\n  const polygonHierarchy = PolygonGeometryLibrary.unpackPolygonHierarchy(\r\n    array,\r\n    startingIndex\r\n  );\r\n  startingIndex = polygonHierarchy.startingIndex;\r\n  delete polygonHierarchy.startingIndex;\r\n  const packedLength = array[startingIndex];\r\n\r\n  if (!defined(result)) {\r\n    result = new CoplanarPolygonOutlineGeometry(scratchOptions);\r\n  }\r\n\r\n  result._polygonHierarchy = polygonHierarchy;\r\n  result.packedLength = packedLength;\r\n\r\n  return result;\r\n};\r\n\r\n/**\r\n * Computes the geometric representation of an arbitrary coplanar polygon, including its vertices, indices, and a bounding sphere.\r\n *\r\n * @param {CoplanarPolygonOutlineGeometry} polygonGeometry A description of the polygon.\r\n * @returns {Geometry|undefined} The computed vertices and indices.\r\n */\r\nCoplanarPolygonOutlineGeometry.createGeometry = function (polygonGeometry) {\r\n  const polygonHierarchy = polygonGeometry._polygonHierarchy;\r\n\r\n  let outerPositions = polygonHierarchy.positions;\r\n  outerPositions = arrayRemoveDuplicates(\r\n    outerPositions,\r\n    Cartesian3.equalsEpsilon,\r\n    true\r\n  );\r\n  if (outerPositions.length < 3) {\r\n    return;\r\n  }\r\n  const isValid = CoplanarPolygonGeometryLibrary.validOutline(outerPositions);\r\n  if (!isValid) {\r\n    return undefined;\r\n  }\r\n\r\n  const polygons = PolygonGeometryLibrary.polygonOutlinesFromHierarchy(\r\n    polygonHierarchy,\r\n    false\r\n  );\r\n\r\n  if (polygons.length === 0) {\r\n    return undefined;\r\n  }\r\n\r\n  const geometries = [];\r\n\r\n  for (let i = 0; i < polygons.length; i++) {\r\n    const geometryInstance = new GeometryInstance({\r\n      geometry: createGeometryFromPositions(polygons[i]),\r\n    });\r\n    geometries.push(geometryInstance);\r\n  }\r\n\r\n  const geometry = GeometryPipeline.combineInstances(geometries)[0];\r\n  const boundingSphere = BoundingSphere.fromPoints(polygonHierarchy.positions);\r\n\r\n  return new Geometry({\r\n    attributes: geometry.attributes,\r\n    indices: geometry.indices,\r\n    primitiveType: geometry.primitiveType,\r\n    boundingSphere: boundingSphere,\r\n  });\r\n};\r\nexport default CoplanarPolygonOutlineGeometry;\r\n","import CoplanarPolygonOutlineGeometry from \"../Core/CoplanarPolygonOutlineGeometry.js\";\r\nimport defined from \"../Core/defined.js\";\r\nimport Ellipsoid from \"../Core/Ellipsoid.js\";\r\n\r\nfunction createCoplanarPolygonOutlineGeometry(polygonGeometry, offset) {\r\n  if (defined(offset)) {\r\n    polygonGeometry = CoplanarPolygonOutlineGeometry.unpack(\r\n      polygonGeometry,\r\n      offset\r\n    );\r\n  }\r\n  polygonGeometry._ellipsoid = Ellipsoid.clone(polygonGeometry._ellipsoid);\r\n  return CoplanarPolygonOutlineGeometry.createGeometry(polygonGeometry);\r\n}\r\nexport default createCoplanarPolygonOutlineGeometry;\r\n"],"names":["createGeometryFromPositions","positions","length","flatPositions","Float64Array","indices","IndexDatatype","createTypedArray","positionIndex","index","i","position","x","y","z","attributes","GeometryAttributes","GeometryAttribute","componentDatatype","ComponentDatatype","DOUBLE","componentsPerAttribute","values","Geometry","primitiveType","PrimitiveType","LINES","CoplanarPolygonOutlineGeometry","options","polygonHierarchy","defaultValue","EMPTY_OBJECT","Check","defined","this","_polygonHierarchy","_workerName","packedLength","PolygonGeometryLibrary","computeHierarchyPackedLength","fromPositions","pack","value","array","startingIndex","typeOf","object","packPolygonHierarchy","scratchOptions","unpack","result","unpackPolygonHierarchy","createGeometry","polygonGeometry","outerPositions","arrayRemoveDuplicates","Cartesian3","equalsEpsilon","CoplanarPolygonGeometryLibrary","validOutline","polygons","polygonOutlinesFromHierarchy","geometries","geometryInstance","GeometryInstance","geometry","push","GeometryPipeline","combineInstances","boundingSphere","BoundingSphere","fromPoints","offset","_ellipsoid","Ellipsoid","clone"],"mappings":"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"}